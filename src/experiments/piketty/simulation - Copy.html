<!DOCTYPE html>
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Dante Tam - Architect of both software and buildings, 4X strategy game dev, CS Berkeley '18, graphics, 3D models.">
    <meta name="author" content="Dante Tam">
    <meta name="keywords" content="Dante Tam, UC Berkeley, Twitter, Machine Learning">
    <link rel="icon" href="./favicon.ico">

    <title>Piketty</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

    <link href="twitter_ipynb.css" rel="stylesheet">

    <!-- Custom stylesheet, it must be in the same directory as the html file -->
    <link rel="stylesheet" href="custom.css">

    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <style>
    body {
      font-family: 'Roboto', serif;
      font-size: 14px;
    }

    h3,h4 {
      text-align: center;
      margin: auto;
    }

    .navbar {
      display: block;
      background-color: white;
    }

    .dropdown.active {
      background-color: black;
      color: rgba(50,100,255);
    }
    </style>

    <!-- Loading mathjax macro -->
    <!-- Load mathjax -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration -->
</head>
    
    
    
<body>

<script src="https://d3js.org/d3.v4.min.js"></script>

<div class="container">

    <div class="intro">
        <br>
        <br>
        <h3>Thomas Piketty: Capital in the Twenty-First Century</h3>
        <br>
        <h4>Wealth and Income Inequalty Simulation</h4>
        <br>
        <p><i>Dante Tam, 8/13/2017</i></p>
        <br>
        <br>
        <br>
        <br>
        <br>
    </div>
<div>

<script>

var actors = [];

var initNumActors = 30;
var birthRate = 20; //per 1,000 people

var returnRateOnCapital = 0.05; //pre-tax
var growthRate = 0.015; //total national growth rate of the economy
var savingRate = 0.12;

//var baseCapitalIncomeRatio = 5; //beta, units of annual national income

var mortalityRate = 7; //per 1,000 people
var lifeExpectancy = 85; 

var startingAverageIncome = 40000;
var startingAverageCapital = 120000;

//2016 US tax brackets, a standard progressive income tax
var progressiveIncomeTaxes = [
    {"income": 0, "taxRate": 0.1},
    {"income": 9275, "taxRate": 0.15},
    {"income": 37650, "taxRate": 0.25},
    {"income": 91150, "taxRate": 0.28},
    {"income": 190150, "taxRate": 0.33},
    {"income": 413350, "taxRate": 0.35},
    {"income": 415050, "taxRate": 0.396},
    {"income": 999999999, "taxRate": 1.0},
    //{"income": 999999999, "taxRate": 1.0}
];

var baseLaborIncome = function(percentile) {
    var data = [
        {"percentile": 0.99, "laborIncome": 7.0},
        {"percentile": 0.9, "laborIncome": 2.0},
        {"percentile": 0.5, "laborIncome": 45.0/40.0},
        {"percentile": 0.0, "laborIncome": 0.6}
    ];
    for (var i = 0; i < data.length; i++) {
        var point = data[i];
        if (percentile > point.percentile) {
            return point.laborIncome;
        }
    }
};

var baseCapital = function(percentile) {
    var data = [
        {"percentile": 0.99, "laborIncome": 20.0},
        {"percentile": 0.9, "laborIncome": 30.0/9.0},
        {"percentile": 0.5, "laborIncome": 40.0/40.0},
        {"percentile": 0.0, "laborIncome": 0.2}
    ];
    for (var i = 0; i < data.length; i++) {
        var point = data[i];
        if (percentile > point.percentile) {
            return point.laborIncome;
        }
    }
};

//This data is evaluated every year

//Evaluate a progressive tax based on the brackets table
function getTaxOwed(income) {
    var bracketIndex = 0;
    var taxOwed = 0;
    while (true) {
        if (bracketIndex >= progressiveIncomeTaxes.length - 1) {
            return taxOwed + income; //Tax 100% the rest of the income above the hard limit
        }
        else if (income > 0) {
            var curBracket = progressiveIncomeTaxes[bracketIndex];
            var nextBracket = progressiveIncomeTaxes[bracketIndex + 1];
            var taxableWithinBracket = Math.min(income, nextBracket.income - curBracket.income);   
         
            taxOwed += curBracket.taxRate * taxableWithinBracket;
            income -= taxableWithinBracket;
            
            bracketIndex++;
        }
        else {
            return taxOwed;
        }
    }
}

console.log(getTaxOwed(50000));

function initActors() {
    for (var i = 0; i < initNumActors; i++) {
        var age = d3.randomUniform(16, 80)();
        var percentile = Math.random();
        
        var income = baseLaborIncome(percentile) * startingAverageIncome;
        var capital = baseCapital(percentile) * startingAverageCapital;
        
        var actor = {"age": age, "income": income, "capital": capital};
        
        actors.push(actor);
    }
}

function gameTurn() {
    
}

initActors();

console.log(actors[0]);

console.log(baseLaborIncome(0.57));
    
</script>   







</body>
